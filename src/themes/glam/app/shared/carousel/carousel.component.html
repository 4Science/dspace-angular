<ngb-carousel #carousel [interval]="carouselInterval" (slide)="onSlide($event)"
              [pauseOnHover]="true" [pauseOnFocus]="false"
              [showNavigationArrows]="false"
              [showNavigationIndicators]="false">
  <ng-template ngbSlide *ngFor="let item of items; let i = index; let last = last">
    <ng-container *ngIf="(itemToImageHrefMap$ | async) as itemToImageHrefMap">
      <div class="row no-gutters">
        <!-- Flexbox requires height to be applied to both columns separately, and to the central nested column of the right column -->
        <ng-container *ngIf="itemToImageHrefMap.get(item.indexableObject.uuid) as href; else placeholderImage">
          <div class="col-lg-8 image-column" [style.height]="carouselHeight"
               [ngStyle]="carouselOptions.showBlurryBackdrop ? {'background-image': getBackgroundImage(href)} : {}">
            <div class="image-wrapper d-flex align-items-center justify-content-center"
                 [class.blurry-backdrop]="carouselOptions.showBlurryBackdrop">
              <img [src]="href" [alt]="item.indexableObject.metadata[title][0].value"
                   [class.w-100]="carouselOptions.fitWidth"
                   [class.h-100]="carouselOptions.fitHeight">
            </div>
          </div>
        </ng-container>
        <ng-template #placeholderImage>
          <div class="col-lg-8 image-column placeholder-image" [style.height]="carouselHeight"></div>
        </ng-template>
        <div class="col-lg-4 caption-column bg-primary" [style.height]="carouselHeight">
          <div class="d-flex flex-row align-items-stretch">
            <!-- left column -->
            <div *ngIf="items.length > 1" class="arrow-wrapper" (click)="carousel.prev()">
              <i class="fa fa-arrow-left text-white"></i>
            </div>
            <!-- central column -->
            <div class="caption-wrapper flex-fill d-flex flex-column justify-content-center gapy-3 py-2" [style.height]="carouselHeight">
              <h1 class="carousel-header text-white" [class]="carouselOptions.titleStyle" *ngIf="item.indexableObject.metadata[title]">
                {{item.indexableObject.metadata[title][0].value}}
              </h1>
              <div class="caption flex-fill text-white text-center" [class]="carouselOptions.captionStyle"
                   *ngIf="item.indexableObject.metadata[description]; let descriptionObj">
                <div class="caption-text">{{descriptionObj[0].value}}</div>
                <div class="caption-fade"></div>
              </div>
              <div class="text-center" *ngIf="getItemLink(item.indexableObject); let currentLink;">
                <a *ngIf="isLinkInternal(currentLink)" [routerLink]="currentLink" class="btn btn-light">
                  {{ 'explore.carousel.view-more' | translate }}
                </a>
                <a *ngIf="!isLinkInternal(currentLink)" [href]="currentLink" [target]="carouselOptions.targetBlank ? '_blank' : null" class="btn btn-light">
                  {{ 'explore.carousel.view-more' | translate }}
                </a>
              </div>
              <button *ngIf="items.length > 1" type="button" class="btn btn-sm toggle-paused text-white" (click)="togglePaused()">
                <i class="fas fa-play" *ngIf="paused"></i>
                <i class="fas fa-pause" *ngIf="!paused"></i>
              </button>
            </div>
            <!-- right column -->
            <div *ngIf="items.length > 1" class="arrow-wrapper" (click)="carousel.next()">
              <i class="fa fa-arrow-right text-white"></i>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </ng-template>
</ngb-carousel>
